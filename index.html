<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>График температуры</title>
    <!-- Подключаем библиотеку Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <h1>График температуры</h1>
    <!-- Создаем контейнер для графика -->
    <div id="graph"></div>

    <!-- Скрипт для создания графика -->
    <script>
        // Функция для получения данных о температуре с сервера ThingSpeak
        function getTemperatureData() {
            // Выполняем GET-запрос к серверу ThingSpeak
            var xhr = new XMLHttpRequest();
            var url = 'https://api.thingspeak.com/channels/2447664/feeds.json?api_key=YGABPVZSCX5NJB3A';
            xhr.open('GET', url, false);
            xhr.send();

            // Парсим ответ сервера
            var response = JSON.parse(xhr.responseText);
            var feeds = response.feeds;

            // Формируем массивы с данными
            var timestamps = feeds.map(function(feed) {
                // Преобразуем время к UTC+7
                var utcTime = new Date(feed.created_at);
                var localTime = new Date(utcTime.getTime() + (7 * 60 * 60 * 1000)); // Добавляем 7 часов в миллисекундах
                return localTime.toLocaleString('ru-RU', { timeZone: 'Asia/Almaty' });
            });

            var temperatures = feeds.map(function(feed) {
                return parseFloat(feed.field1);
            });

            return { timestamps: timestamps, temperatures: temperatures };
        }

        // Получаем данные о температуре с сервера ThingSpeak
        var data = getTemperatureData();

        // Создаем объект с настройками графика
        var layout = {
            title: 'График температуры',
            xaxis: { title: 'Время', range: [0, 24], tickangle: 45, tickfont: { size: 10 }, automargin: true }, // Устанавливаем диапазон оси x от 0 до 24 часов и поворот подписей
            yaxis: { title: 'Температура (градусы Цельсия)' }
        };

        // Создаем объект с данными для графика
        var trace = {
            x: data.timestamps,
            y: data.temperatures,
            type: 'scatter',
            mode: 'lines+markers', // Добавляем отображение точек значений на линии
            marker: { size: 8 } // Устанавливаем размер точек значений
        };

        // Рисуем график
        Plotly.newPlot('graph', [trace], layout);
    </script>
</body>
</html>
